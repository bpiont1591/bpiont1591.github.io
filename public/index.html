<!DOCTYPE html>
<html>
<head>
  <title>Statystyki serwera</title>
</head>
<body>
  <h1>Statystyki serwera</h1>
  <div id="stats">Ładowanie...</div>
  <div id="new-members">Ładowanie nowych użytkowników...</div>
  <script>
    async function fetchStats() {
      try {
        const [statsResponse, activeMembersResponse, newMembersResponse] = await Promise.all([
          fetch('/api/stats'),
          fetch('/api/active-members'),
          fetch('/api/new-members')
        ]);
        const statsText = await statsResponse.text();
        const activeMembersText = await activeMembersResponse.text();
        const newMembersText = await newMembersResponse.text();

        console.log('statsResponse:', statsText); // Dodane logowanie odpowiedzi
        console.log('activeMembersResponse:', activeMembersText); // Dodane logowanie odpowiedzi
        console.log('newMembersResponse:', newMembersText); // Dodane logowanie odpowiedzi

        const stats = JSON.parse(statsText);
        const activeMembers = JSON.parse(activeMembersText);
        const newMembers = JSON.parse(newMembersText);

        document.getElementById('stats').innerHTML = `
          <p>Liczba członków: \${stats.memberCount}</p>
          <p>Liczba ról: \${stats.rolesCount}</p>
          <p>Liczba wiadomości w ciągu ostatniego dnia: \${stats.messagesCount}</p>
          <p>Liczba aktywnych użytkowników: \${activeMembers.onlineMembers}</p>
        `;
        document.getElementById('new-members').innerHTML = `
          <h2>Nowi użytkownicy (ostatni tydzień)</h2>
          <ul>\${newMembers.newMembersList.map(member => \`<li>\${member}</li>\`).join('')}</ul>
        `;
      } catch (error) {
        console.error('Błąd przy pobieraniu statystyk:', error);
        document.getElementById('stats').innerText = 'Wystąpił błąd.';
        document.getElementById('new-members').innerText = 'Wystąpił błąd przy pobieraniu nowych użytkowników.';
      }
    }
    fetchStats();
  </script>
</body>
</html>

